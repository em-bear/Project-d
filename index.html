<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Project-D</title>
    <style>
        * { box-sizing: border-box; touch-action: none; }
        body { 
            margin: 0; background: #000; color: #fff; 
            font-family: sans-serif; display: flex; 
            flex-direction: column; align-items: center; height: 100vh;
        }
        #startScreen, #editor { 
            display: none; width: 100%; height: 100%; 
            flex-direction: column; align-items: center; justify-content: center; 
        }
        #topBar { 
            display: flex; flex-wrap: wrap; gap: 4px; padding: 5px; 
            justify-content: center; background: #111; width: 100%;
        }
        .color-btn { 
            width: 35px; height: 35px; border: 2px solid #444; border-radius: 4px; 
        }
        .color-btn.active { border-color: #fff; transform: scale(1.1); }
        #grid { 
            display: grid; grid-template-columns: repeat(32, 1fr); 
            width: 95vw; height: 65vh; margin: 10px 0; border: 1px solid #333;
        }
        .cell { border: 0.1px solid #222; background: #000; }
        .hidden { display: none; }
        #zoomBar, #controls { display: flex; gap: 5px; margin-bottom: 5px; }
        button { 
            padding: 8px 12px; font-size: 14px; cursor: pointer; 
            background: #333; color: white; border: 1px solid #666; 
        }
        #newBtn { font-size: 30px; padding: 20px 50px; background: #28a745; border: none; }
    </style>
</head>
<body>

<div id="startScreen">
    <button id="newBtn" onclick="startNew()">NEW</button>
</div>

<div id="editor">
    <div id="topBar" id="colors"></div>
    <div id="zoomBar">
        <button onclick="applyZoom(-1)">ALL</button>
        <div id="zoomButtons"></div>
    </div>
    <div id="grid"></div>
    <div id="controls">
        <button onclick="saveTxt()" style="background:#007bff">SAVE</button>
        <button onclick="doneTxt()" style="background:#dc3545">DONE</button>
    </div>
</div>

<script>
    const colors = ["red","green","blue","yellow","orange","purple","pink","cyan","lime","brown","white","gray","navy","teal","magenta"];
    let selectedColor = "red";
    let drawingData = new Map();
    let isTouching = false;

    // Színpaletta és Zoom gombok létrehozása
    const topBar = document.getElementById("topBar");
    colors.forEach(c => {
        const btn = document.createElement("div");
        btn.className = "color-btn";
        btn.style.background = c;
        if(c === selectedColor) btn.classList.add("active");
        btn.onclick = () => {
            document.querySelectorAll(".color-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            selectedColor = c;
        };
        topBar.appendChild(btn);
    });

    const zoomDiv = document.getElementById("zoomButtons");
    for(let i=0; i<8; i++) {
        const b = document.createElement("button");
        b.innerText = "Z" + (i+1);
        b.onclick = () => applyZoom(i);
        zoomDiv.appendChild(b);
    }

    // Grid (1024 kocka)
    const grid = document.getElementById("grid");
    for(let y=0; y<32; y++) {
        for(let x=0; x<32; x++) {
            const cell = document.createElement("div");
            cell.className = "cell";
            cell.dataset.x = x;
            cell.dataset.y = y;
            
            const paint = (e) => {
                const key = `${x}-${y}`;
                if (drawingData.has(key)) {
                    drawingData.delete(key);
                    cell.style.background = "#000";
                } else {
                    drawingData.set(key, selectedColor);
                    cell.style.background = selectedColor;
                }
            };

            cell.onpointerdown = (e) => { isTouching = true; cell.releasePointerCapture(e.pointerId); paint(); };
            cell.onpointerenter = () => { if(isTouching) paint(); };
            grid.appendChild(cell);
        }
    }
    window.onpointerup = () => isTouching = false;

    function startNew() {
        drawingData.clear();
        document.querySelectorAll(".cell").forEach(c => c.style.background = "#000");
        document.getElementById("startScreen").style.display = "none";
        document.getElementById("editor").style.display = "flex";
        applyZoom(-1);
    }

    function applyZoom(part) {
        const cells = document.querySelectorAll(".cell");
        if (part === -1) {
            cells.forEach(c => c.classList.remove("hidden"));
            grid.style.gridTemplateColumns = "repeat(32, 1fr)";
        } else {
            // 8 részre osztás: 4 oszlop x 2 sor
            const col = part % 4; 
            const row = Math.floor(part / 4);
            const xMin = col * 8, xMax = xMin + 8;
            const yMin = row * 16, yMax = yMin + 16;

            cells.forEach(c => {
                const x = parseInt(c.dataset.x);
                const y = parseInt(c.dataset.y);
                c.classList.toggle("hidden", !(x >= xMin && x < xMax && y >= yMin && y < yMax));
            });
            grid.style.gridTemplateColumns = "repeat(8, 1fr)";
        }
    }

    function download(filename, text) {
        const element = document.createElement('a');
        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
        element.setAttribute('download', filename);
        element.click();
    }

    function saveTxt() {
        let out = "";
        drawingData.forEach((color, coord) => out += `${coord} ${color}\n`);
        download("coordinates.txt", out);
        document.getElementById("editor").style.display = "none";
        document.getElementById("startScreen").style.display = "flex";
    }

    function doneTxt() {
        download("done.txt", "done");
    }

    document.getElementById("startScreen").style.display = "flex";
</script>
</body>
</html>
